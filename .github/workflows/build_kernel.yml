name: Build Kernel

on:
  push:
  workflow_dispatch:

jobs:
  build:
    name: Build Kernel
    runs-on: ubuntu-20.04
    steps:

      - name: Checkout
        uses: actions/checkout@v3

      - name: Install GCC 9
        run: |
          sudo apt-get update
          sudo apt-get install -y gcc-8 g++-8 gcc-8-aarch64-linux-gnu

      - name: Set up cross-compiler
        run: |
          sudo ln -s /usr/bin/gcc-8-aarch64-linux-gnu /usr/bin/gcc-aarch64-linux-gnu
          echo "/usr/bin" >> $GITHUB_PATH

      - name: Build kernel
        working-directory: kernel-4.14
        run: |
          export ARCH=arm64
          export CROSS_COMPILE=aarch64-linux-gnu-
          make a05bd_defconfig
          make -j8

      - name: Upload
        uses: actions/upload-artifact@v3
        with:
          name: TAB-A05-BD-kernel
          path: |
            kernel/arch/arm64/boot/*
          if-no-files-found: ignore
